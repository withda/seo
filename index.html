<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Suah blog Posting</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
    
    * { box-sizing: border-box; }
    
    body { 
      font-family: 'Poppins', sans-serif; 
      max-width: 900px; 
      margin: 0 auto; 
      padding: 1rem;
      background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
      min-height: 100vh;
      color: #2d3748;
    }
    
    h1 { 
      text-align: center; 
      color: #e53e3e;
      font-weight: 700;
      font-size: 2rem;
      text-shadow: 2px 2px 4px rgba(255,255,255,0.8);
      margin-bottom: 1.5rem;
      line-height: 1.2;
    }
    
    h2 {
      color: #d53f8c;
      font-weight: 600;
      margin-bottom: 1rem;
      font-size: 1.2rem;
    }
    
    .section { 
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(10px);
      border: none;
      padding: 1.5rem; 
      margin-bottom: 1rem; 
      border-radius: 15px; 
      box-shadow: 0 8px 32px rgba(255,182,193,0.3);
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .section input[type="text"], .section input[type="password"] {
      margin-top: .8rem; 
      width: 100%; 
      padding: 12px 16px;
      border: 2px solid #fbb6ce;
      border-radius: 12px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: rgba(255,255,255,0.9);
    }
    
    .section input[type="text"]:focus, .section input[type="password"]:focus {
      outline: none;
      border-color: #e53e3e;
      box-shadow: 0 0 0 3px rgba(229,62,62,0.1);
      transform: translateY(-2px);
    }
    
    .section button { 
      margin-top: 1rem; 
      padding: 12px 24px; 
      background: linear-gradient(135deg, #e53e3e 0%, #f56565 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1rem;
      width: 100%;
    }
    
    .section button:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(229,62,62,0.3);
    }
    
    .section button:active {
      transform: translateY(0);
    }
    
    .section button:disabled {
      background: #cbd5e0;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .helper { 
      font-size: 0.85rem; 
      color: #718096; 
      margin-top: .5rem;
      line-height: 1.5;
    }
    
    #articles { 
      max-height: 300px; 
      overflow-y: auto; 
      border: 2px solid #fbb6ce; 
      padding: 1rem; 
      font-size: .9rem;
      border-radius: 12px;
      background: rgba(255,255,255,0.8);
    }
    
    .article-item { 
      display: flex; 
      align-items: flex-start; 
      margin-bottom: .8rem;
      padding: 8px;
      border-radius: 8px;
      transition: background 0.2s ease;
    }
    
    .article-item:hover {
      background: rgba(255,182,193,0.2);
    }
    
    .article-item input[type="radio"] { 
      margin-right: .8rem;
      margin-top: 2px;
      accent-color: #e53e3e;
      flex-shrink: 0;
    }
    
    .article-item label { 
      flex: 1; 
      cursor: pointer;
      font-weight: 400;
      line-height: 1.4;
      word-break: break-word;
    }
    
    #preview { 
      overflow-y: auto;
      background: rgba(255,255,255,0.9);
      padding: 1.5rem;
      border-radius: 12px;
      margin-top: 1rem;
      border: 2px solid #fbb6ce;
      max-height: 500px;
    }
    
    #preview img { 
      display: block; 
      width: 100%; 
      height: auto; 
      object-fit: contain; 
      margin: 1rem 0;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    #preview h3 {
      color: #d53f8c;
      margin-bottom: 1rem;
      font-weight: 600;
      font-size: 1.3rem;
      line-height: 1.3;
    }
    
    .hidden { display: none; }
    
    .export-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
      font-size: 0.9rem !important;
      padding: 10px 16px !important;
      margin: 0 !important;
    }
    
    .export-btn:hover {
      background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%) !important;
      transform: translateY(-2px);
    }
    
    #publishBtn {
      background: linear-gradient(135deg, #38a169 0%, #48bb78 100%) !important;
      font-size: 1.1rem !important;
      padding: 15px 30px !important;
      margin-top: 1rem !important;
    }
    
    #publishBtn:hover {
      background: linear-gradient(135deg, #2f855a 0%, #38a169 100%) !important;
    }
    
    /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
    #articles::-webkit-scrollbar, #preview::-webkit-scrollbar {
      width: 6px;
    }
    
    #articles::-webkit-scrollbar-track, #preview::-webkit-scrollbar-track {
      background: rgba(255,182,193,0.2);
      border-radius: 3px;
    }
    
    #articles::-webkit-scrollbar-thumb, #preview::-webkit-scrollbar-thumb {
      background: #fbb6ce;
      border-radius: 3px;
    }
    
    #articles::-webkit-scrollbar-thumb:hover, #preview::-webkit-scrollbar-thumb:hover {
      background: #e53e3e;
    }

    /* ëª¨ë°”ì¼ ë°˜ì‘í˜• ë””ìì¸ */
    @media (max-width: 768px) {
      body {
        padding: 0.5rem;
      }
      
      h1 {
        font-size: 1.8rem;
        margin-bottom: 1rem;
      }
      
      h2 {
        font-size: 1.1rem;
      }
      
      .section {
        padding: 1rem;
        margin-bottom: 0.8rem;
        border-radius: 12px;
      }
      
      .section input[type="text"], .section input[type="password"] {
        padding: 10px 12px;
        font-size: 16px; /* iOS ì¤Œ ë°©ì§€ */
      }
      
      .section button {
        padding: 14px 20px;
        font-size: 1rem;
        margin-top: 0.8rem;
      }
      
      .helper {
        font-size: 0.8rem;
      }
      
      #articles {
        max-height: 250px;
        padding: 0.8rem;
        font-size: 0.85rem;
      }
      
      .article-item {
        padding: 6px;
        margin-bottom: 0.6rem;
      }
      
      .article-item label {
        font-size: 0.85rem;
      }
      
      #preview {
        padding: 1rem;
        max-height: 400px;
        font-size: 0.9rem;
        word-break: break-word;
        line-height: 1.6;
      }
      
      #preview h2, #preview h3, #preview h4 {
        word-break: keep-all;
        word-wrap: break-word;
        line-height: 1.4;
        margin: 1rem 0 0.5rem 0;
      }
      
      #preview p {
        word-break: break-word;
        line-height: 1.6;
        margin-bottom: 1rem;
      }
      
      #preview h3 {
        font-size: 1.1rem;
      }
      
      #publishBtn {
        font-size: 1rem !important;
        padding: 14px 24px !important;
      }
      
      /* ìŠ¤í¬ë¡¤ë°” ëª¨ë°”ì¼ì—ì„œ ë” ì–‡ê²Œ */
      #articles::-webkit-scrollbar, #preview::-webkit-scrollbar {
        width: 4px;
      }
    }

    /* ì•„ì£¼ ì‘ì€ í™”ë©´ (380px ì´í•˜) */
    @media (max-width: 380px) {
      body {
        padding: 0.3rem;
      }
      
      h1 {
        font-size: 1.5rem;
      }
      
      .section {
        padding: 0.8rem;
      }
      
      .section input[type="text"], .section input[type="password"] {
        padding: 8px 10px;
      }
      
      #articles {
        max-height: 200px;
        padding: 0.6rem;
      }
      
      #preview {
        padding: 0.8rem;
        max-height: 350px;
      }
    }
  </style>
</head>
<body>
  <h1>ğŸ“° Suah AI Auto Posting(WordPress)</h1>

  <div class="section">
    <h2>â‘  WordPress API ì •ë³´</h2>
    <p class="helper">ì›Œë“œí”„ë ˆìŠ¤ ì‚¬ì´íŠ¸ URL, ì‚¬ìš©ìëª…(ì›Œë“œí”„ë ˆìŠ¤ ê³„ì •) ë° App Password(ì›Œë“œí”„ë ˆìŠ¤ ì•± ë¹„ë°€ë²ˆí˜¸)ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
    <input type="text" id="wp_site" placeholder="Site URL (https://example.com)" />
    <input type="text" id="wp_user" placeholder="User ID (ì›Œë“œí”„ë ˆìŠ¤ ì‚¬ìš©ìëª…)" />
    <input type="password" id="wp_pass" placeholder="App Password (ì›Œë“œí”„ë ˆìŠ¤ ì•± ë¹„ë°€ë²ˆí˜¸)" />
    <button id="saveWpBtn">ì €ì¥</button>
  </div>

  <div class="section">
    <h2>â‘¡ API Keys ì„¤ì •</h2>
    <input type="password" id="openai_key" placeholder="OpenAI API Key" />
    <input type="text" id="pexels_key" placeholder="Pexels API Key" />
    <button id="saveKeysBtn">ì €ì¥</button>
  </div>

  <div class="section">
    <h2>â‘¢ ê¸°ì‚¬ ê²€ìƒ‰</h2>
    <input type="text" id="query" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" />
    <button id="searchBtn">ê²€ìƒ‰</button>
    <div id="articles"></div>
  </div>

  <div class="section hidden" id="actions">
    <h2>ìƒì„± & ë¯¸ë¦¬ë³´ê¸°</h2>
    <button id="generateBtn">ìƒì„±</button>
    <div id="preview"></div>
    
    <!-- ì €ì¥/ë³µì‚¬ ì˜µì…˜ -->
    <div id="exportOptions" class="hidden" style="margin-top: 1rem;">
      <h3 style="color: #d53f8c; font-size: 1.1rem; margin-bottom: 1rem;">ğŸ“‹ ë‚´ë³´ë‚´ê¸° ì˜µì…˜</h3>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.8rem; margin-bottom: 1rem;">
        <button id="copyHtmlBtn" class="export-btn">ğŸ“„ HTML ë³µì‚¬</button>
        <button id="copyMarkdownBtn" class="export-btn">ğŸ“ Markdown ë³µì‚¬</button>
        <button id="downloadHtmlBtn" class="export-btn">ğŸ’¾ HTML ì €ì¥</button>
        <button id="downloadMarkdownBtn" class="export-btn">ğŸ’¾ MD ì €ì¥</button>
        <button id="captureBtn" class="export-btn">ğŸ“¸ ì´ë¯¸ì§€ ì €ì¥</button>
      </div>
    </div>
    
    <button id="publishBtn" disabled>ğŸš€ WP ë°œí–‰</button>
  </div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  ['wp_site','wp_user','wp_pass','openai_key','pexels_key'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = localStorage[id] || '';
  });
  
  document.getElementById('saveWpBtn').onclick = () => {
    ['wp_site','wp_user','wp_pass'].forEach(id => localStorage[id] = document.getElementById(id).value.trim());
    alert('âœ… ì›Œë“œí”„ë ˆìŠ¤ ì •ë³´ ì €ì¥');
  };
  
  document.getElementById('saveKeysBtn').onclick = () => {
    ['openai_key','pexels_key'].forEach(id => localStorage[id] = document.getElementById(id).value.trim());
    alert('âœ… API í‚¤ ì €ì¥');
  };

  function fetchWithTimeout(url, opts={}, ms=15000) {
    const controller = new AbortController(), timeout = setTimeout(() => controller.abort(), ms);
    return fetch(url, {...opts, signal: controller.signal}).finally(() => clearTimeout(timeout));
  }
  
  const PROXIES = [
    u => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(u)}`,
    u => `https://thingproxy.freeboard.io/fetch/${u}`,
    u => `https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`
  ];
  
  async function fetchText(url) {
    for (const fn of PROXIES) {
      try {
        const res = await fetchWithTimeout(fn(url)); if (!res.ok) throw new Error(res.status);
        return await res.text();
      } catch (e) { console.warn('Proxy failed', e); }
    }
    throw new Error('ëª¨ë“  í”„ë¡ì‹œ ì‹¤íŒ¨');
  }

  async function translateToEnglish(text) {
    const resp = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=ko|en`);
    const json = await resp.json(); return json.responseData.translatedText;
  }

  let _items = [], _post = null;
  const publishBtn = document.getElementById('publishBtn');

  // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
  function htmlToMarkdown(html) {
    return html
      .replace(/<h([1-6])>(.*?)<\/h[1-6]>/gi, (match, level, text) => '#'.repeat(parseInt(level)) + ' ' + text + '\n\n')
      .replace(/<p>(.*?)<\/p>/gi, '$1\n\n')
      .replace(/<br\s*\/?>/gi, '\n')
      .replace(/<strong>(.*?)<\/strong>/gi, '**$1**')
      .replace(/<b>(.*?)<\/b>/gi, '**$1**')
      .replace(/<em>(.*?)<\/em>/gi, '*$1*')
      .replace(/<i>(.*?)<\/i>/gi, '*$1*')
      .replace(/<a href="(.*?)".*?>(.*?)<\/a>/gi, '[$2]($1)')
      .replace(/<img[^>]*src="([^"]*)"[^>]*alt="([^"]*)"[^>]*>/gi, '![${2}]($1)')
      .replace(/<img[^>]*src="([^"]*)"[^>]*>/gi, '![]($1)')
      .replace(/<ul>/gi, '').replace(/<\/ul>/gi, '\n')
      .replace(/<ol>/gi, '').replace(/<\/ol>/gi, '\n')
      .replace(/<li>(.*?)<\/li>/gi, '- $1\n')
      .replace(/<[^>]*>/g, '')
      .replace(/\n\s*\n\s*\n/g, '\n\n')
      .trim();
  }

  function downloadFile(content, filename, type) {
    const blob = new Blob([content], { type });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  async function copyToClipboard(text) {
    try {
      await navigator.clipboard.writeText(text);
      return true;
    } catch (err) {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand('copy');
      document.body.removeChild(textarea);
      return true;
    }
  }

  // ë‚´ë³´ë‚´ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ë“¤
  document.getElementById('copyHtmlBtn').onclick = async () => {
    if (!_post) return alert('ë¨¼ì € ìƒì„±ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
    const htmlContent = `<h1>${_post.title}</h1>\n<p><strong>ë©”íƒ€ ì„¤ëª…:</strong> ${_post.meta_description}</p>\n<p><strong>í‚¤ì›Œë“œ:</strong> ${_post.keywords.join(', ')}</p>\n${_post.imgUrl ? `<img src="${_post.imgUrl}" alt="${_post.title}" style="width: 100%; height: auto;">` : ''}\n${_post.content}`;
    await copyToClipboard(htmlContent);
    alert('âœ… HTMLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
  };

  document.getElementById('copyMarkdownBtn').onclick = async () => {
    if (!_post) return alert('ë¨¼ì € ìƒì„±ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
    const markdownContent = `# ${_post.title}\n\n**ë©”íƒ€ ì„¤ëª…:** ${_post.meta_description}\n\n**í‚¤ì›Œë“œ:** ${_post.keywords.join(', ')}\n\n${_post.imgUrl ? `![${_post.title}](${_post.imgUrl})\n\n` : ''}${htmlToMarkdown(_post.content)}`;
    await copyToClipboard(markdownContent);
    alert('âœ… Markdownì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
  };

  document.getElementById('downloadHtmlBtn').onclick = () => {
    if (!_post) return alert('ë¨¼ì € ìƒì„±ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
    const htmlContent = `<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="${_post.meta_description}">
  <meta name="keywords" content="${_post.keywords.join(', ')}">
  <title>${_post.title}</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 800px; margin: 0 auto; padding: 2rem; line-height: 1.6; }
    h1 { color: #2d3748; border-bottom: 3px solid #e53e3e; padding-bottom: 0.5rem; }
    img { width: 100%; height: auto; border-radius: 8px; margin: 1rem 0; }
    .meta-info { background: #fbb6ce; padding: 0.5rem 1rem; border-radius: 8px; margin: 1rem 0; }
  </style>
</head>
<body>
  <h1>${_post.title}</h1>
  <div class="meta-info">
    <p><strong>ë©”íƒ€ ì„¤ëª…:</strong> ${_post.meta_description}</p>
    <p><strong>ë©”ì¸í‚¤ì›Œë“œ:</strong> ${_post.mainKeyword}</p>
    <p><strong>í‚¤ì›Œë“œ:</strong> ${_post.keywords.join(', ')}</p>
  </div>
  ${_post.imgUrl ? `<img src="${_post.imgUrl}" alt="${_post.title}">` : ''}
  ${_post.content}
</body>
</html>`;
    downloadFile(htmlContent, `${_post.title.replace(/[^a-zA-Z0-9ê°€-í£]/g, '_')}.html`, 'text/html');
  };

  document.getElementById('downloadMarkdownBtn').onclick = () => {
    if (!_post) return alert('ë¨¼ì € ìƒì„±ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
    const markdownContent = `# ${_post.title}\n\n**ë©”íƒ€ ì„¤ëª…:** ${_post.meta_description}\n\n**ë©”ì¸í‚¤ì›Œë“œ:** ${_post.mainKeyword}\n\n**í‚¤ì›Œë“œ:** ${_post.keywords.join(', ')}\n\n${_post.imgUrl ? `![${_post.title}](${_post.imgUrl})\n\n` : ''}${htmlToMarkdown(_post.content)}`;
    downloadFile(markdownContent, `${_post.title.replace(/[^a-zA-Z0-9ê°€-í£]/g, '_')}.md`, 'text/markdown');
  };

  document.getElementById('captureBtn').onclick = async () => {
    if (!_post) return alert('ë¨¼ì € ìƒì„±ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
    try {
      if (!window.html2canvas) {
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
        document.head.appendChild(script);
        await new Promise(resolve => script.onload = resolve);
      }
      
      const preview = document.getElementById('preview');
      const canvas = await html2canvas(preview, {
        backgroundColor: '#ffffff',
        scale: 2,
        useCORS: true
      });
      
      canvas.toBlob(blob => {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${_post.title.replace(/[^a-zA-Z0-9ê°€-í£]/g, '_')}.png`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      });
      
    } catch (err) {
      alert('âŒ ì´ë¯¸ì§€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ì—ì„œ ìŠ¤í¬ë¦°ìƒ·ì„ ì°ì–´ì£¼ì„¸ìš”.');
    }
  };

  document.getElementById('searchBtn').onclick = async () => {
    const q = document.getElementById('query').value.trim(); if (!q) return alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
    const ct = document.getElementById('articles'); ct.textContent = 'âŒ› ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦';
    
    let allItems = [];
    
    // 1. êµ¬ê¸€ ë‰´ìŠ¤ RSSì—ì„œ ê²€ìƒ‰
    const googleRssUrl = `https://news.google.com/rss/search?q=${encodeURIComponent(q)}&hl=ko&gl=KR&ceid=KR:ko`;
    try {
      const res = await fetchWithTimeout(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(googleRssUrl)}`);
      const j = await res.json(); 
      if (j.status==='ok') {
        const googleItems = j.items.map(it=>({ 
          title: it.title, 
          link: it.link, 
          pubDate: it.pubDate,
          source: 'google',
          score: 1 
        }));
        allItems = allItems.concat(googleItems);
      }
    } catch {
      try {
        const xml = await fetchText(googleRssUrl);
        const doc = new DOMParser().parseFromString(xml,'application/xml');
        const googleItems = Array.from(doc.querySelectorAll('item')).map(it=>({
          title: it.querySelector('title')?.textContent||'',
          link: it.querySelector('link')?.textContent||'',
          pubDate: it.querySelector('pubDate')?.textContent||'',
          source: 'google',
          score: 1
        }));
        allItems = allItems.concat(googleItems);
      } catch(e) { console.warn('Google RSS failed', e); }
    }
    
    // 2. ë„¤ì´ë²„ ë­í‚¹ RSSì—ì„œ ì¸ê¸° ê¸°ì‚¬ ê°€ì ¸ì˜¤ê¸°
    const naverRankingUrls = [
      'https://rss.news.naver.com/services/news/mainnews.xml', // ë©”ì¸ë‰´ìŠ¤
      'https://rss.news.naver.com/services/news/ranking/popular_day.xml' // ë­í‚¹ë‰´ìŠ¤
    ];
    
    for (const naverUrl of naverRankingUrls) {
      try {
        const xml = await fetchText(naverUrl);
        const doc = new DOMParser().parseFromString(xml,'application/xml');
        const naverItems = Array.from(doc.querySelectorAll('item')).map(it=>({
          title: it.querySelector('title')?.textContent||'',
          link: it.querySelector('link')?.textContent||'',
          pubDate: it.querySelector('pubDate')?.textContent||'',
          source: 'naver',
          score: 3 // ë„¤ì´ë²„ ë­í‚¹ì€ ë†’ì€ ì ìˆ˜
        })).filter(item => 
          // ê²€ìƒ‰ì–´ì™€ ê´€ë ¨ëœ ê¸°ì‚¬ë§Œ í•„í„°ë§
          item.title.toLowerCase().includes(q.toLowerCase()) ||
          q.split(' ').some(keyword => item.title.toLowerCase().includes(keyword.toLowerCase()))
        );
        allItems = allItems.concat(naverItems);
      } catch(e) { console.warn('Naver RSS failed', e); }
    }
    
    // 3. ì¤‘ë³µ ì œê±° (ë¹„ìŠ·í•œ ì œëª©ì˜ ê¸°ì‚¬)
    const uniqueItems = [];
    for (const item of allItems) {
      const isDuplicate = uniqueItems.some(existing => {
        const similarity = getSimilarity(item.title, existing.title);
        return similarity > 0.7; // 70% ì´ìƒ ìœ ì‚¬í•˜ë©´ ì¤‘ë³µìœ¼ë¡œ ê°„ì£¼
      });
      if (!isDuplicate) {
        uniqueItems.push(item);
      }
    }
    
    // 4. ì ìˆ˜ ê¸°ë°˜ ì •ë ¬ (ì¸ê¸°ë„ + ìµœì‹ ì„±)
    uniqueItems.forEach(item => {
      const timeScore = (Date.now() - new Date(item.pubDate)) / (1000 * 60 * 60); // ì‹œê°„ ì ìˆ˜
      const keywordScore = countKeywords(item.title, q); // í‚¤ì›Œë“œ ë§¤ì¹­ ì ìˆ˜
      item.finalScore = item.score + keywordScore * 2 - timeScore * 0.1;
    });
    
    _items = uniqueItems.sort((a,b) => b.finalScore - a.finalScore);
    
    ct.innerHTML=''; 
    const actionsEl = document.getElementById('actions');
    if (!_items.length) { 
      if (actionsEl) actionsEl.classList.add('hidden'); 
      return alert('ê´€ë ¨ ê¸°ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.'); 
    }
    
    const cnt=Math.min(_items.length,30);
    for(let i=0;i<cnt;i++){
      const it=_items[i];
      const d=new Date(it.pubDate).toISOString().slice(0,16).replace('T',' ');
      const sourceIcon = it.source === 'naver' ? 'ğŸ”¥' : 'ğŸ“°';
      ct.insertAdjacentHTML('beforeend',`<div class="article-item"><input type="radio" name="art" id="a${i}" value="${i}"><label for="a${i}">${sourceIcon} ${i+1}. ${it.title} [${d}]</label></div>`);
    }
    if (actionsEl) actionsEl.classList.remove('hidden');
  };
  
  // ìœ ì‚¬ë„ ê³„ì‚° í•¨ìˆ˜
  function getSimilarity(str1, str2) {
    const longer = str1.length > str2.length ? str1 : str2;
    const shorter = str1.length > str2.length ? str2 : str1;
    if (longer.length === 0) return 1.0;
    return (longer.length - editDistance(longer, shorter)) / longer.length;
  }
  
  function editDistance(s1, s2) {
    s1 = s1.toLowerCase();
    s2 = s2.toLowerCase();
    const costs = [];
    for (let i = 0; i <= s2.length; i++) {
      let lastValue = i;
      for (let j = 0; j <= s1.length; j++) {
        if (i === 0) costs[j] = j;
        else if (j > 0) {
          let newValue = costs[j - 1];
          if (s1.charAt(j - 1) !== s2.charAt(i - 1)) newValue = Math.min(Math.min(newValue, lastValue), costs[j]) + 1;
          costs[j - 1] = lastValue;
          lastValue = newValue;
        }
      }
      if (i > 0) costs[s1.length] = lastValue;
    }
    return costs[s1.length];
  }
  
  // í‚¤ì›Œë“œ ë§¤ì¹­ ì ìˆ˜ ê³„ì‚°
  function countKeywords(title, query) {
    const keywords = query.toLowerCase().split(' ');
    const titleLower = title.toLowerCase();
    return keywords.reduce((score, keyword) => {
      return score + (titleLower.includes(keyword) ? 1 : 0);
    }, 0);
  }

  document.getElementById('generateBtn').onclick = async () => {
    _post = null;
    publishBtn.disabled = true;
    const exportOptions = document.getElementById('exportOptions');
    if (exportOptions) exportOptions.classList.add('hidden');
    const sel = document.querySelector("input[name='art']:checked"); if (!sel) return alert('ê¸°ì‚¬ ì„ íƒ í•„ìš”');
    const article = _items[+sel.value];
    const pv = document.getElementById('preview'); pv.innerHTML = 'ìƒì„± ì¤‘â€¦';

    try {
      const aiKey = localStorage.openai_key; if (!aiKey) throw new Error('OpenAI í‚¤ í•„ìš”');
      const prompt = `ë‹¹ì‹ ì€ êµ¬ê¸€ SEO ì „ë¬¸ê°€ì´ì í•œêµ­ì˜ ì¸ê¸° ë¸”ë¡œê±°ì…ë‹ˆë‹¤. Rank Math SEO í”ŒëŸ¬ê·¸ì¸ì—ì„œ 100ì ì„ ë°›ì„ ìˆ˜ ìˆëŠ” ì™„ë²½í•œ ë¸”ë¡œê·¸ ê¸€ì„ ì‘ì„±í•˜ì„¸ìš”.

ì‘ë‹µì„ JSON ê°ì²´ë¡œë§Œ ë°˜í™˜í•˜ì„¸ìš” (title, meta_description, content, keywords, tags).

## Rank Math SEO ìµœì í™” ìš”êµ¬ì‚¬í•­

### ê¸°ë³¸ SEO ì„¤ì •
- Focus Keyword: ë©”ì¸ í‚¤ì›Œë“œ ë°€ë„ 0.5-2.5% ìœ ì§€
- Titleì— Focus Keyword í¬í•¨ (ì•ìª½ ë°°ì¹˜ ì„ í˜¸)
- Meta Descriptionì— Focus Keyword í¬í•¨
- URLì— Focus Keyword í¬í•¨ ê°€ëŠ¥í•˜ë„ë¡ ì˜ë¬¸ ìŠ¬ëŸ¬ê·¸ ì œì•ˆ

### ì½˜í…ì¸  ê¸¸ì´ ë° êµ¬ì¡°
- ìµœì†Œ 600ë‹¨ì–´ ì´ìƒ (í•œê¸€ ê¸°ì¤€ 2,400ì ì´ìƒ)
- H1 íƒœê·¸ 1ê°œ (ì œëª©)
- H2 íƒœê·¸ 3-6ê°œ (ì£¼ìš” ì„¹ì…˜)
- H3 íƒœê·¸ ì ì ˆíˆ í™œìš©
- ê° H2 ì„¹ì…˜ë§ˆë‹¤ ìµœì†Œ 150ë‹¨ì–´ ì´ìƒ

### Rank Math ì²´í¬ë¦¬ìŠ¤íŠ¸
- Focus Keywordê°€ ì œëª© ì•ìª½ 60% ë‚´ì— ìœ„ì¹˜
- Focus Keywordê°€ ë©”íƒ€ ì„¤ëª…ì— í¬í•¨
- Focus Keywordê°€ ì²« ë²ˆì§¸ ë‹¨ë½ì— í¬í•¨
- Focus Keywordê°€ H2 íƒœê·¸ ì¤‘ ìµœì†Œ 1ê°œì— í¬í•¨
- ì´ë¯¸ì§€ Alt í…ìŠ¤íŠ¸ì— Focus Keyword í¬í•¨
- ë‚´ë¶€ ë§í¬ì™€ ì™¸ë¶€ ë§í¬ í¬í•¨
- Table of Contents (ëª©ì°¨) êµ¬ì¡° ì œê³µ

### í‚¤ì›Œë“œ ìµœì í™”
- ì£¼ìš” í‚¤ì›Œë“œ ë°€ë„ 1.5-2.5% ìœ ì§€
- LSI í‚¤ì›Œë“œ (ê´€ë ¨ í‚¤ì›Œë“œ) ìì—°ìŠ¤ëŸ½ê²Œ í¬í•¨
- í‚¤ì›Œë“œ ë³€í˜•ê³¼ ë™ì˜ì–´ í™œìš©
- í‚¤ì›Œë“œ ìŠ¤í„°í•‘ ì ˆëŒ€ ê¸ˆì§€

### ì‚¬ëŒë‹¤ìš´ ê¸€ì“°ê¸° ìŠ¤íƒ€ì¼
- "ìˆì–ì•„ìš”", "ê·¸ë‹ˆê¹Œìš”", "ì†”ì§íˆ ë§í•˜ë©´" ë“± ìì—°ìŠ¤ëŸ¬ìš´ êµ¬ì–´ì²´
- ê°œì¸ì  ê²½í—˜ê³¼ ê°ì • í‘œí˜„ í’ë¶€í•˜ê²Œ í¬í•¨
- ë‹¤ì–‘í•œ ë¬¸ì¥ ê¸¸ì´ì™€ ë‹¨ë½ êµ¬ì„±
- ì‹¤íŒ¨ë‹´, ì„±ê³µë‹´ ë“± ì§„ì†”í•œ ì´ì•¼ê¸°

### ì‚¬ìš©ì ê²½í—˜ ìµœì í™”
- ìŠ¤ìº” ê°€ëŠ¥í•œ êµ¬ì¡° (ë¶ˆë¦¿ í¬ì¸íŠ¸, ë²ˆí˜¸ ëª©ë¡)
- í•µì‹¬ ë‚´ìš©ì„ ê°•ì¡° í‘œì‹œ
- FAQ ì„¹ì…˜ í¬í•¨
- ìš”ì•½ ë° ê²°ë¡  ì œê³µ

### ìˆ˜ìµí™” CTA ë° ì™¸ë¶€ë§í¬ ì „ëµ
- ê¸€ ì¤‘ê°„ 3-4ê³³ì— ìì—°ìŠ¤ëŸ¬ìš´ ìˆ˜ìµí™” CTA ì‚½ì…
- ê´€ë ¨ ì‚¬ì´íŠ¸ë¡œì˜ ë§í¬ì™€ ë§¤ë ¥ì ì¸ ë²„íŠ¼ ë¬¸êµ¬ ìƒì„±
- "ìµœì €ê°€ í™•ì¸", "íŠ¹ê°€ í˜œíƒ", "ì§€ê¸ˆ ë°”ë¡œ" ë“±ì˜ êµ¬ë§¤ ìœ ë„ ë¬¸êµ¬ ì‚¬ìš©
- íŒŒíŠ¸ë„ˆìŠ¤ í™œë™ ê³ ì§€ ë¬¸êµ¬ í¬í•¨

### ì™¸ë¶€ë§í¬ ë° ë²„íŠ¼ ë¬¸êµ¬ ì˜ˆì‹œ
- <a href="#" class="cta-button">ì§€ê¸ˆ ìµœì €ê°€ í™•ì¸í•˜ê¸°</a>
- <a href="#" class="info-button">ê³µì‹ ì‚¬ì´íŠ¸ì—ì„œ ìì„¸íˆ ë³´ê¸°</a>
- <a href="#" class="review-button">ì‹¤ì œ í›„ê¸° ë” ë³´ê¸°</a>

### ì¶œë ¥ êµ¬ì¡°
1. title: Rank Math ìµœì í™”ëœ 60ì ì´ë‚´ SEO ì œëª©
2. meta_description: Focus Keyword í¬í•¨ 150ì ì´ë‚´ ë©”íƒ€ ì„¤ëª…
3. content: ìœ„ ëª¨ë“  ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ìµœì†Œ 5,000ì ì´ìƒì˜ HTML ì½˜í…ì¸ 
   - ëª©ì°¨ (Table of Contents) êµ¬ì¡° í¬í•¨
   - Focus Keywordê°€ ì²« ë¬¸ë‹¨ì— í¬í•¨
   - H2 íƒœê·¸ ì¤‘ ìµœì†Œ 1ê°œì— Focus Keyword í¬í•¨
   - ë‚´ë¶€/ì™¸ë¶€ ë§í¬ í¬í•¨
   - FAQ ì„¹ì…˜ í¬í•¨
4. keywords: SEO ìµœì í™”ëœ ì£¼ìš” í‚¤ì›Œë“œ 5-8ê°œ
5. tags: ë¸”ë¡œê·¸ íƒœê·¸ìš© í‚¤ì›Œë“œ 8-12ê°œ

ê¸°ì‚¬ ì œëª©: ${article.title}

Rank Math SEOì—ì„œ 100ì ì„ ë°›ì„ ìˆ˜ ìˆë„ë¡ ìœ„ ëª¨ë“  ì¡°ê±´ì„ ì² ì €íˆ ì§€ì¼œì„œ ì™„ë²½í•œ SEO ë¸”ë¡œê·¸ ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.`;
      const resAI = await fetch('https://api.openai.com/v1/chat/completions',{ method:'POST', headers:{ 'Content-Type':'application/json', Authorization:`Bearer ${aiKey}` }, body: JSON.stringify({ model:'gpt-4o-mini', messages:[{ role:'system', content:'ë‹¹ì‹ ì€ Rank Math SEO ì „ë¬¸ê°€ì…ë‹ˆë‹¤. Rank Mathì—ì„œ 100ì ì„ ë°›ëŠ” ì™„ë²½í•œ SEO ìµœì í™” ê¸€ì„ ì‘ì„±í•˜ì—¬ JSONë§Œ ë°˜í™˜í•˜ì„¸ìš”.' },{ role:'user', content:prompt }], temperature:0.7, max_tokens:4000 }) });
      if (!resAI.ok) throw new Error(`OpenAI ì˜¤ë¥˜: ${resAI.status}`);
      let raw = (await resAI.json()).choices[0].message.content.trim(); raw = raw.replace(/^```(?:json)?/,'').replace(/```$/,'').trim();
      let data;
      try { data = JSON.parse(raw); } catch (pe) { console.error('Parsing error:', raw); throw new Error('JSON íŒŒì‹± ì‹¤íŒ¨: '+pe.message); }
      // êµ¬ì¡° ê²€ì¦ ë° ê¸°ë³¸ê°’ ì„¤ì •
      if (!data.title) throw new Error('ì œëª©ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
      if (!data.content) throw new Error('ë‚´ìš©ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
      if (!data.keywords) data.keywords = [];
      if (!data.tags) data.tags = data.keywords || [];
      if (!data.meta_description) data.meta_description = data.content.replace(/<[^>]*>/g, '').slice(0, 150) + '...';
      // keywordsì™€ tagsë¥¼ ë°°ì—´ë¡œ ê°•ì œ ë³€í™˜
      if (!Array.isArray(data.keywords)) data.keywords = [data.keywords];
      if (!Array.isArray(data.tags)) data.tags = [data.tags];

      const cleanContent = data.content.replace(/<img[^>]*>/gi,'');
      const engTitle = await translateToEnglish(article.title);
      let pxRes = await fetch(`https://api.pexels.com/v1/search?query=${encodeURIComponent(engTitle)}&orientation=landscape&per_page=1`,{ headers:{ Authorization: localStorage.pexels_key } });
      if (!pxRes.ok) throw new Error('Pexels ì˜¤ë¥˜');
      let photos = (await pxRes.json()).photos;
      if (!photos || photos.length === 0) { const fb = await fetch(`https://api.pexels.com/v1/curated?per_page=1`,{ headers:{ Authorization: localStorage.pexels_key } }); photos = (await fb.json()).photos; }
      const imgUrl = photos.length>0 ? photos[0].src.large2x : '';
      const imgHtml = imgUrl ? `<img src="${imgUrl}" alt="ëŒ€í‘œ ì´ë¯¸ì§€">` : `<p style="color:gray;">ëŒ€í‘œ ì´ë¯¸ì§€ ì—†ìŒ</p>`;
      pv.innerHTML = `<h3>${data.title}</h3><p><strong>ë©”íƒ€ ì„¤ëª…:</strong> ${data.meta_description}</p><p><strong>í‚¤ì›Œë“œ:</strong> ${data.keywords.join(', ')}</p><div>${imgHtml}<div style="margin-top: 1rem;">${cleanContent}</div></div>`;
      _post = { title: data.title, content: cleanContent, tags: data.tags, keywords: data.keywords, meta_description: data.meta_description, imgUrl };
      publishBtn.disabled = false;
      const exportOptions = document.getElementById('exportOptions');
      if (exportOptions) exportOptions.classList.remove('hidden');
    } catch (err) {
      console.error(err);
      pv.innerHTML = `<p style="color:red;">âŒ ${err.message}</p>`;
    }
  };

  publishBtn.onclick = async () => {
    alert('âš ï¸ ì´ ê¸°ëŠ¥ì€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒì„±ëœ ì½˜í…ì¸ ë¥¼ ë³µì‚¬í•´ì„œ ìˆ˜ë™ìœ¼ë¡œ ë¸”ë¡œê·¸ì— ì˜¬ë ¤ì£¼ì„¸ìš”.');
  };
});
</script>
</body>
</html>
